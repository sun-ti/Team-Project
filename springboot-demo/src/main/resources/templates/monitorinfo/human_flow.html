<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../css/layui.css">
    <style>
        .layui-table-cell .layui-form-checkbox[lay-skin="primary"] {
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<div>

    <div class="layui-inline">
        <input type="text" class="layui-input" id="searchTimeRange" placeholder="请选择搜索时间范围">
    </div>


    <table id="table" lay-filter="table"></table>

    <script type="text/html" id="monitorinfoTool">
        <a class="layui-btn layui-btn-xs" lay-event="image1View">查看照片1</a>
        <a class="layui-btn layui-btn-xs" lay-event="image2View">查看照片2</a>
        <a class="layui-btn layui-btn-xs" lay-event="msgView">查看信息</a>
    </script>
    <script src="../layui.js"></script>
    <script th:inline="none">
        layui.use(['table', 'layer', 'laydate', 'carousel', 'util'], function () {
            var carousel = layui.carousel;
            var table = layui.table;
            var laydate = layui.laydate;
            var util = layui.util;

            table.render({
                elem: '#table'
                , url: 'humanFlowList' // 数据接口
                , page: true // 开启分页
                , width: 1000
                , limits: [10]
                , cols: [[ //表头
                    {type: 'numbers', title: '序号'}
                    , {
                        field: 'datetime', title: '记录时间', sort: true, templet: function (data) {
                            return layui.util.toDateString(data.datetime);
                        }
                    }
                    , {field: 'stationid', title: '站点名称'}
                    , {field: 'deviceip', title: '设备 IP 地址'}
                    , {fixed: 'right', minWidth: 280, align: 'center', toolbar: '#monitorinfoTool'}
                ]]
                , response: {
                    statusCode: 200
                }
            });

            // 时间选择组件
            laydate.render({
                elem: '#searchTimeRange'
                , range: true
                , max: 0
                , done: function (value, date, endDate) {
                    var startDate;
                    var endDate;
                    if (value != "") {
                        startDate = date.year + "-" + date.month + "-" + date.date + " " +
                            date.hours + ":" + date.minutes + ":" + date.seconds;
                        endDate = endDate.year + "-" + endDate.month + "-" + endDate.date + " " +
                            endDate.hours + ":" + endDate.minutes + ":" + endDate.seconds;
                    } else {
                        startDate = "";
                        endDate = "";
                    }
                    table.reload('table', {
                        page: {curr: 1}
                        , where: {
                            startDate: startDate
                            , endDate: endDate
                        }
                    });
                }
            });


            table.on('tool(table)', function (obj) {
                var data = obj.data;
                var layEvent = obj.event;
                var tr = obj.tr;
                var layer = layui.layer;

                var image1HTML = '<img style="height:280px;width:600px" src="' + data['pic1'] + '"/>';
                var image2HTML = '<img style="height:280px;width:600px" src="' + data['pic2'] + '"/>';

                var content = '<div class="layui-carousel" id="imageView" style="background: transparent"><div carousel-item>' +
                    '<div style="background: transparent">' + image1HTML + '</div>' +
                    '<div style="background: transparent">' + image2HTML + '</div>' +
                    '</div></div>';

                var initImgIndex; // 默认图片
                if (layEvent === 'image1View') {
                    initImgIndex = 0;
                } else if (layEvent === 'image2View') {
                    initImgIndex = 1;
                } else if (layEvent === 'msgView') {
                    content = '<div style="padding: 10px"><p>' + obj.data['errMsg'] + '</p></div>'
                }
                layer.open({
                    type: 1
                    , offset: ['100px', '200px']
                    // , shade: 0
                    , shadeClose: true
                    , title: false
                    , content: content
                    , index: initImgIndex
                    , success: function (layero, index) {
                        layer.style(index, {
                            background: 'transparent'
                        });
                        carousel.render({
                            elem: '#imageView'
                            // , width: '400px'
                            // , height: '400px'
                            , arrow: 'always'
                            , autoplay: false
                            // , indicator: 'outside'
                        });
                    }
                });
            })
        });


    </script>
</div>
</html>